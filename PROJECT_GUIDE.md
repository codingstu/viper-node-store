# Viper Node Store - é¡¹ç›®ç»“æ„ä¸åŠŸèƒ½æŒ‡å—

## é¡¹ç›®æ¦‚è¿°

Viper Node Store æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒèŠ‚ç‚¹çš„å¢åˆ æ”¹æŸ¥ã€å¥åº·æ£€æŸ¥ã€VIP æ¿€æ´»ç ç®¡ç†å’Œæ€§èƒ½æµ‹é€Ÿã€‚

## æ ¸å¿ƒåŠŸèƒ½

### 1. èŠ‚ç‚¹ç®¡ç†
- **è·å–èŠ‚ç‚¹åˆ—è¡¨** - æ”¯æŒåˆ†é¡µã€æœç´¢ã€æ’åº
- **æ·»åŠ èŠ‚ç‚¹** - æ”¯æŒå•ä¸ª/æ‰¹é‡å¯¼å…¥
- **ç¼–è¾‘èŠ‚ç‚¹** - æ›´æ–°èŠ‚ç‚¹åç§°ã€åœ°å€ã€ç«¯å£ç­‰
- **åˆ é™¤èŠ‚ç‚¹** - æ”¯æŒæ‰¹é‡åˆ é™¤
- **å¥åº·æ£€æŸ¥** - å®šæœŸæ£€æµ‹èŠ‚ç‚¹å¯ç”¨æ€§

### 2. æ¿€æ´»ç ç³»ç»Ÿ
- **VIP æ¿€æ´»ç ** - ç”¨æˆ·æ¿€æ´»é«˜çº§åŠŸèƒ½
- **æ¿€æ´»ç éªŒè¯** - éªŒè¯æ¿€æ´»ç æ˜¯å¦æœ‰æ•ˆ
- **æ¿€æ´»ç ç®¡ç†** - ç”Ÿæˆã€ç¦ç”¨æ¿€æ´»ç 
- **é™åˆ¶ç­–ç•¥** - å…è´¹ç‰ˆç”¨æˆ·é™åˆ¶èŠ‚ç‚¹æ•°é‡

### 3. æ€§èƒ½æµ‹é€Ÿ
- **å»¶è¿Ÿæµ‹è¯•** - é€šè¿‡ Cloudflare Worker è¿›è¡Œå›½å¤–å»¶è¿Ÿæµ‹è¯•
- **è¯„åˆ†ç³»ç»Ÿ** - æ ¹æ®å»¶è¿Ÿç»™å‡º 0-100 åˆ†è¯„åˆ†
- **æ‰¹é‡æµ‹é€Ÿ** - æ”¯æŒå¤šèŠ‚ç‚¹å¹¶å‘æµ‹è¯•

### 4. åœ°åŸŸä¿¡æ¯
- **åœ°åŸŸæ£€æµ‹** - è¯†åˆ«ç”¨æˆ·ä½ç½®
- **åŒºåŸŸåˆ’åˆ†** - CN/å…¶ä»–åœ°åŒºèŠ‚ç‚¹åˆ†ç±»
- **ä¼˜åŒ–æ¨è** - æ ¹æ®ç”¨æˆ·åœ°åŸŸæ¨èèŠ‚ç‚¹

## ç³»ç»Ÿæ¶æ„

```
viper-node-store/
â”œâ”€â”€ frontend/          # React å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ api/               # Vercel æ— æœåŠ¡å‡½æ•° API
â”‚   â””â”€â”€ index.py      # FastAPI å¤„ç†å‡½æ•°
â”œâ”€â”€ public/            # å…¬å¼€èµ„æº
â”‚   â””â”€â”€ nodes.json     # èŠ‚ç‚¹æ•°æ®ï¼ˆéœ€è¦ .gitignoreï¼‰
â”œâ”€â”€ cloudflare_worker.js  # Cloudflare Worker ä»£ç†è„šæœ¬
â”œâ”€â”€ backend.py/        # æœ¬åœ°åç«¯ï¼ˆå¼€å‘ç”¨ï¼‰
â””â”€â”€ docs/              # æ–‡æ¡£ç›®å½•
```

## éƒ¨ç½²ç¯å¢ƒ

### å‰ç«¯
- **éƒ¨ç½²å¹³å°**: Vercel
- **æ¡†æ¶**: React
- **å¯åŠ¨æ–¹å¼**: `npm start` æˆ– Vercel è‡ªåŠ¨éƒ¨ç½²

### åç«¯ API
- **éƒ¨ç½²å¹³å°**: Vercel æ— æœåŠ¡å‡½æ•°
- **æ¡†æ¶**: FastAPI
- **æ–‡ä»¶**: `/api/index.py`
- **ç«¯ç‚¹**: https://viper-node-store-api.vercel.app/

### Cloudflare Worker
- **ç”¨é€”**: åŸŸåä»£ç†ã€è¯·æ±‚è½¬å‘
- **éƒ¨ç½²ä½ç½®**: Cloudflare Workers
- **ç›®æ ‡åŸŸå**: node.peachx.tech
- **è„šæœ¬ä½ç½®**: `cloudflare_worker.js`

### æœ¬åœ°å¼€å‘ç¯å¢ƒ
- **åç«¯**: è¿è¡Œ `python app.py` æˆ– `python app_fastapi.py`ï¼ˆé»˜è®¤ç«¯å£ 8000ï¼‰
- **å‰ç«¯**: è¿è¡Œ `npm start`ï¼ˆé»˜è®¤ç«¯å£ 3000ï¼‰

## æ•°æ®åº“

### Supabase é…ç½®
- **é¡¹ç›®å**: viper-node-store
- **è¡¨å**: nodes, activation_codes
- **è¿æ¥æ–¹å¼**: REST API + SQL

### å…³é”®è¡¨ç»“æ„

**nodes è¡¨**:
```sql
id (UUID)
name (Text)
host (Text)
port (Integer)
created_at (Timestamp)
updated_at (Timestamp)
region (Text) -- åœ°åŸŸä¿¡æ¯
status (Text) -- å¥åº·çŠ¶æ€
```

**activation_codes è¡¨**:
```sql
id (UUID)
code (Text, Unique)
is_used (Boolean)
used_by (UUID)
used_at (Timestamp)
created_at (Timestamp)
expires_at (Timestamp)
```

## é‡è¦æ³¨æ„äº‹é¡¹

### âš ï¸ æ–‡ä»¶å®‰å…¨
1. **nodes.json** - åŒ…å«æ•æ„ŸèŠ‚ç‚¹ä¿¡æ¯ï¼Œ**å·²æ·»åŠ åˆ° .gitignore**
2. **.env** - åŒ…å« API å¯†é’¥å’Œæ•°æ®åº“å‡­è¯ï¼Œ**ç»ä¸æäº¤**
3. **ç”Ÿäº§ç¯å¢ƒå¯†é’¥** - å­˜å‚¨åœ¨ Vercel/Supabase ç¯å¢ƒå˜é‡

### ğŸ” GitHub Workflow
- **é—®é¢˜**: å·¥ä½œæµæ–‡ä»¶éœ€è¦ PAT å…·æœ‰ `workflow` ä½œç”¨åŸŸ
- **è§£å†³**: åœ¨ GitHub Settings ç”Ÿæˆæ–° PATï¼Œå‹¾é€‰ `workflow` æƒé™
- **æ–‡ä»¶**: `.github/workflows/update-nodes.yml` å·²ä» Git ä¸­ç§»é™¤

### ğŸŒ Cloudflare Worker ä»£ç†
- **ç”¨é€”**: ç»•è¿‡è·¨åŸŸé™åˆ¶ï¼Œä»£ç†è¯·æ±‚åˆ° node.peachx.tech
- **æœºåˆ¶**: 
  - é¦–æ¬¡è®¿é—®æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
  - è®¾ç½® `visited` cookie é¿å…é‡å¤åŠ è½½
  - è½¬å‘è¯·æ±‚åˆ°ç›®æ ‡åŸŸå
  - è¿”å›å“åº” + CORS å¤´
- **é…ç½®**: ä¿®æ”¹ `cloudflare_worker.js` ä¸­çš„ `targetDomain`

### ğŸ”§ æœ¬åœ°è°ƒè¯•
```bash
# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨åç«¯
python app_fastapi.py  # æˆ– python app.py

# å¯åŠ¨å‰ç«¯
cd frontend && npm start

# æŸ¥çœ‹æ—¥å¿—
tail -f backend.log
tail -f frontend.log
```

## API å‚è€ƒ

### èŠ‚ç‚¹æ¥å£
- **GET /api/nodes** - è·å–èŠ‚ç‚¹åˆ—è¡¨ï¼ˆæ”¯æŒè¿‡æ»¤ï¼šcountry, protocol, min_speed, max_latencyï¼‰
- **POST /api/nodes** - åˆ›å»ºèŠ‚ç‚¹
- **PUT /api/nodes/{id}** - æ›´æ–°èŠ‚ç‚¹
- **DELETE /api/nodes/{id}** - åˆ é™¤èŠ‚ç‚¹

### åŒæ­¥æ¥å£
- **GET /api/sync-info** - è·å–èŠ‚ç‚¹åŒæ­¥çŠ¶æ€
- **POST /api/webhook/spiderflow** - SpiderFlow Webhook æ¥æ”¶ç«¯ç‚¹

### æ¿€æ´»ç æ¥å£
- **GET /api/activation-codes** - è·å–æ¿€æ´»ç åˆ—è¡¨
- **POST /api/activation-codes/verify** - éªŒè¯æ¿€æ´»ç 

## èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸç®¡ç†

### è‡ªåŠ¨å»é‡æœºåˆ¶
- **å”¯ä¸€æ€§æ ‡å‡†**: `protocol + host + port`
- **ä¿ç•™ç­–ç•¥**: ä¿ç•™é¦–æ¬¡å‘ç°çš„èŠ‚ç‚¹ï¼Œæ›´æ–° `last_updated_at`
- **æ—¶é—´æˆ³**: `first_seen_at`ï¼ˆä¸å¯ä¿®æ”¹ï¼‰ã€`last_updated_at`ï¼ˆå®æ—¶æ›´æ–°ï¼‰

### TTL ç®¡ç†ï¼ˆTime-To-Liveï¼‰
- **TTL ç­–ç•¥**: 3 å¤©
- **èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸ**:
  - ç¬¬ 1 å¤©ï¼šæ–°å¢èŠ‚ç‚¹ï¼Œå…¨éƒ¨å¯ç”¨
  - ç¬¬ 2 å¤©ï¼šéªŒè¯æ´»è·ƒåº¦
  - ç¬¬ 3 å¤©ï¼šæ ‡è®°è¿‡æœŸå‰æœ€åæ£€æŸ¥
  - ç¬¬ 4 å¤©ï¼šåˆ é™¤è¿‡æœŸèŠ‚ç‚¹

### Webhook é›†æˆ
- **æ¥æº**: SpiderFlow å®Œæˆæ£€æµ‹åæ¨é€
- **ç«¯ç‚¹**: POST `/api/webhook/spiderflow`
- **éªŒè¯**: ç­¾åéªŒè¯ç¡®ä¿æ•°æ®æ¥æºçœŸå®
- **æµç¨‹**: æ¥æ”¶ â†’ éªŒè¯ â†’ å»é‡ â†’ æ›´æ–°æ•°æ®åº“

## å¸¸è§é—®é¢˜å¤„ç†

### èŠ‚ç‚¹åŠ è½½å¤±è´¥
- æ£€æŸ¥ Supabase è¿æ¥
- éªŒè¯ API ç«¯ç‚¹æ˜¯å¦å¯è¾¾
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯

### VIP æ¿€æ´»ç æ— æ³•ä½¿ç”¨
- æ£€æŸ¥æ¿€æ´»ç æ˜¯å¦è¿‡æœŸï¼ˆ`expires_at` å­—æ®µï¼‰
- æ£€æŸ¥æ¿€æ´»ç æ˜¯å¦å·²ä½¿ç”¨ï¼ˆ`is_used` å­—æ®µï¼‰
- éªŒè¯ç”¨æˆ· ID æ˜¯å¦æ­£ç¡®ä¼ é€’

### Cloudflare Worker ç™½å±
- æ£€æŸ¥ç›®æ ‡åŸŸåæ˜¯å¦å¯è¾¾
- æŸ¥çœ‹ Cloudflare å®æ—¶æ—¥å¿—
- ç¡®ä¿æµè§ˆå™¨æ”¯æŒ CORS è¯·æ±‚

### åŒæ­¥çŠ¶æ€æ˜¾ç¤ºä¸º 0
- ç¡®ä¿å‰åç«¯åœ¨åŒä¸€ç½‘ç»œæˆ–å¯é€šä¿¡
- æ£€æŸ¥ API ç«¯ç‚¹é…ç½®ï¼ˆlocalhost vs å®é™… IPï¼‰
- é™çº§æ–¹æ¡ˆï¼šä»é¡µé¢ DOM è¯»å–å®é™…èŠ‚ç‚¹æ•°

## éƒ¨ç½²æ­¥éª¤

### 1. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 2. å¯åŠ¨åç«¯
```bash
# ä½¿ç”¨ FastAPI
python app_fastapi.py
# æˆ–ä½¿ç”¨ uvicorn
uvicorn app_fastapi:app --reload --host 0.0.0.0 --port 8002
```

**é¢„æœŸè¾“å‡º**:
```
âœ… å¯åŠ¨æ•°æ®åŒæ­¥è°ƒåº¦å™¨ | è½®è¯¢é—´éš”: 300ç§’
âœ… èŠ‚ç‚¹éªŒè¯å®šæ—¶å™¨å·²å¯åŠ¨ (æ¯å¤©2:00æ‰§è¡Œ)
INFO:     Uvicorn running on http://0.0.0.0:8002
```

### 3. å¯åŠ¨å‰ç«¯
```bash
cd frontend && npm start
# è®¿é—® http://localhost:3000
```

### 4. é…ç½® Cloudflare Worker
```bash
# ç¼–è¾‘ cloudflare_worker.js
# ä¿®æ”¹ targetDomain ä¸ºå®é™…ç›®æ ‡
# éƒ¨ç½²åˆ° Cloudflare Dashboard
```

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¸»è¦æ›´æ–° |
|------|------|--------|
| 1.0 | 2026-01-02 | åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«èŠ‚ç‚¹ç®¡ç†å’Œ VIP æ¿€æ´» |
| 1.1 | 2026-01-06 | æ·»åŠ  Cloudflare Worker ä»£ç†ï¼Œä¿®å¤è·¨åŸŸé—®é¢˜ |
| 1.2 | 2026-01-06 | æ•´åˆ API å‚è€ƒã€èŠ‚ç‚¹ç”Ÿå‘½å‘¨æœŸã€Webhook é›†æˆæ–‡æ¡£ |

## è”ç³»æ–¹å¼

é¡¹ç›®ç»´æŠ¤ï¼šviper-node-store GitHub ä»“åº“

---

**æœ€åæ›´æ–°**: 2026-01-06
