å®Œæ•´ä¼šè¯ä¸æ“ä½œæ€»ç»“ â€” åŒåŒºåŸŸèŠ‚ç‚¹æµ‹é€Ÿï¼ˆAliyun FC / Cloudflare Workerï¼‰

æ—¥æœŸ: 2025-12-31
å·¥ä½œåŒº: /Users/ikun/study/Learning/
ç›¸å…³é¡¹ç›®:
- SpiderFlow (backend): /Users/ikun/study/Learning/SpiderFlow/backend
- viper-node-store (frontend): /Users/ikun/study/Learning/viper-node-store

ä¸€ã€ç›®æ ‡
- ä¸º viper-node-store æä¾›åŒåŒºåŸŸï¼ˆå¤§é™† / æµ·å¤–ï¼‰èŠ‚ç‚¹æµ‹é€Ÿæ•°æ®ã€‚
- å‰ç«¯æŒ‰ `mainland_score > 0` / `overseas_score > 0` ä¸¥æ ¼è¿‡æ»¤å¹¶å±•ç¤ºå¯¹åº”èŠ‚ç‚¹ã€‚

äºŒã€ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ
- åç«¯: FastAPI (uvicorn) åœ¨ http://127.0.0.1:8000
  - èŠ‚ç‚¹çŒæ‰‹æ¨¡å—: `app/modules/node_hunter`ï¼Œè´Ÿè´£æŠ“å–ã€åŸºç¡€æµ‹è¯•ã€ä»¥åŠå¯é€‰çš„é«˜çº§åŒåŒºåŸŸæµ‹é€Ÿã€‚
  - Supabase ä½œä¸ºæ•°æ®å­˜å‚¨ï¼ˆè¡¨ `nodes`ï¼‰ï¼Œæ–°å¢å­—æ®µï¼š`mainland_score`, `mainland_latency`, `overseas_score`, `overseas_latency`ã€‚
- å‰ç«¯: viper-node-store é™æ€é¡µé¢ï¼Œé€šè¿‡æœ¬åœ°ä»£ç† `http://127.0.0.1:8080` è®¿é—® APIã€‚
- ä¸¤ä¸ªå¤–éƒ¨æµ‹é€ŸæœåŠ¡ï¼š
  - Aliyun FCï¼ˆå¤§é™†æµ‹é€Ÿï¼‰: https://mainland-probe-eyptbwbaco.cn-hangzhou.fcapp.run
  - Cloudflare Workerï¼ˆæµ·å¤–æµ‹é€Ÿï¼‰: https://mainland-node-overseas-probe.sdemon9963.workers.dev

ä¸‰ã€å·²å®Œæˆçš„é‡è¦ä¿®æ”¹ä¸çŠ¶æ€ï¼ˆå…³é”®æ–‡ä»¶ï¼‰
1) å‰ç«¯ï¼š`viper-node-store/index.html`
   - ä¿®æ”¹ `fetchData()` ä¸­çš„è¿‡æ»¤é€»è¾‘ï¼š
     - `å¤§é™†`ï¼ˆå¤§æŒ‰é’®ï¼‰ç°åœ¨ä¸¥æ ¼ç­›é€‰ `mainland_score > 0`ã€‚
     - `æµ·å¤–`ï¼ˆå°æŒ‰é’®ï¼‰ä¸¥æ ¼ç­›é€‰ `overseas_score > 0`ã€‚
     - å–æ¶ˆäº†åŸºäº `country` çš„å›é€€é€»è¾‘ï¼ˆæ­¤å‰ä¼šæŠŠ CN èŠ‚ç‚¹å½“å¤§é™†ã€é CN å½“æµ·å¤–ï¼‰ã€‚
   - ç»“æœï¼šåœ¨æ²¡æœ‰æ‰§è¡ŒåŒåŒºåŸŸæµ‹é€Ÿå‰ï¼Œ`å¤§é™†` ä¸ `æµ·å¤–` ä¼šæ˜¾ç¤ºä¸ºç©ºï¼ˆNO SIGNALï¼‰ï¼Œè¿™æ˜¯é¢„æœŸè¡Œä¸ºã€‚

2) åç«¯ï¼š`app/modules/node_hunter/advanced_speed_test.py`
   - å®ç° `test_nodes_via_aliyun(nodes, mark_field='mainland')` å’Œ `test_nodes_via_cloudflare(nodes, mark_field='overseas')`ã€‚
   - è¿”å›æ ¼å¼ä¸ºæ•°ç»„ï¼š`[{id, host, port, latency, score, success, region?}, ...]`ã€‚
   - ä¸»å‡½æ•° `run_advanced_speed_test(nodes)` åˆå¹¶ä¸¤ä¾§è¿”å›å¹¶æŠŠ `mainland_score/latency` ä¸ `overseas_score/latency` å†™å›èŠ‚ç‚¹å¯¹è±¡ã€‚
   - ä¾èµ–ç¯å¢ƒå˜é‡ï¼š`ADVANCED_TEST_ENABLED=true`ã€`ALIYUN_FC_URL`ã€`CLOUDFLARE_WORKER_URL`ã€‚

3) åç«¯ï¼š`app/modules/node_hunter/node_hunter.py`
   - åœ¨ `scan_cycle()` ä¸­è°ƒç”¨ `await self.test_and_update_nodes(unique_nodes)` åï¼Œå†æ ¹æ®ç¯å¢ƒå˜é‡è°ƒç”¨ `run_advanced_speed_test(self.nodes)`ã€‚
   - éšåæŠŠ `alive_nodes` ä¸Šä¼ åˆ° Supabaseï¼ˆ`upload_to_supabase()`ï¼‰ï¼Œæ¯æ¡è®°å½•åŒ…å«ä¸¤åœ°åŒºåˆ†æ•°å­—æ®µã€‚

4) åç«¯ï¼š`app/modules/node_hunter/supabase_helper.py`
   - `upload_to_supabase(nodes)` å°†æ¯ä¸ªèŠ‚ç‚¹è½¬æ¢ä¸º Supabase çš„è®°å½•ï¼ˆå•æ¡è®°å½•åŒ…å« `mainland_*` ä¸ `overseas_*` å­—æ®µï¼‰ï¼Œå¹¶ä½¿ç”¨ `upsert` åˆ†æ‰¹ä¸Šä¼ ï¼ˆbatch_size=50ï¼‰ã€‚

å››ã€ç°åœºè§‚æµ‹ï¼ˆè¿è¡Œä¸æ—¥å¿—ï¼‰
- åç«¯è¿›ç¨‹åœ¨æœ¬æœºè¿è¡Œï¼ˆPID ç¤ºä¾‹: 94950ï¼‰ï¼Œuvicorn å¯åŠ¨æˆåŠŸã€‚
- æˆ‘è§¦å‘äº† `POST /nodes/trigger`ï¼ˆè·¯ç”±ï¼š`/nodes/trigger`ï¼‰ï¼Œè¿”å› `{"status":"running"}` æˆ– `{"status":"started"}` è¡¨ç¤ºæ‰«æå·²å¯åŠ¨ã€‚
- `GET /nodes/stats` è¿”å› JSONï¼ŒåŒ…å« `running: true/false` ä¸ `logs` æ•°ç»„ã€‚
- åœ¨ä¸€æ¬¡è§¦å‘åï¼Œæ—¥å¿—æ˜¾ç¤ºâ€œğŸ‰ æµ‹è¯•å®Œæˆï¼æœ‰æ•ˆèŠ‚ç‚¹: 258/413â€ï¼Œä½†é€šè¿‡å‰ç«¯ä»£ç† `http://127.0.0.1:8080/api/nodes?limit=10` æŸ¥è¯¢æ—¶ï¼Œ`mainland_score` ä¸ `overseas_score` ä¾ç„¶ä¸º `0`ã€‚
- æˆ‘ç›´æ¥å‘ Aliyun FC ä¸ Cloudflare Worker å‘èµ·å•èŠ‚ç‚¹è¯·æ±‚ï¼Œä¸¤ä¸ªæœåŠ¡å‡è¿”å›æ­£ç¡®çš„ç»“æ„ï¼Œä½† `success:false`ï¼ˆå¯èƒ½å› ä»å½“å‰ç½‘ç»œç¯å¢ƒæ— æ³•è¿é€šç›®æ ‡èŠ‚ç‚¹ï¼‰ï¼Œä¾‹å¦‚ï¼š
  - Aliyun è¿”å›: `[{"id":"104.248.161.181:443","latency":-1,"success":false}]`
  - Cloudflare è¿”å›: `[{"id":"104.248.161.181:443","latency":-1,"score":0,"success":false,"region":"Global"}]`
- åç«¯æ—¥å¿—ä¸­å¹¶æœªæ‰¾åˆ°æ˜ç¡®çš„ Aliyun/Cloudflare æˆåŠŸæ—¥å¿—ï¼ˆè¯´æ˜å¤–éƒ¨æœåŠ¡è¿”å›äº†å¤±è´¥æˆ–åç«¯æœªèƒ½åŸºäºè¿”å›æ›´æ–° Supabaseï¼‰ã€‚

äº”ã€å·²åšçš„æ’æŸ¥ä¸ç»“è®º
1) ç¯å¢ƒå˜é‡æ˜¯å¦ç”Ÿæ•ˆ
   - `.env` ä¸­ç¡®å®é…ç½®äº† `ADVANCED_TEST_ENABLED=true` ä¸ä¸¤ä¸ªå¤–éƒ¨ URLã€‚
   - æ³¨æ„ï¼šè‹¥æ¨¡å—åœ¨ `load_dotenv()` è¢«è°ƒç”¨ä¹‹å‰å°±è¢«å¯¼å…¥ï¼Œ`os.getenv()` è¯»å–å¯èƒ½ä¸åŒ…å« `.env` æ›´æ–°ï¼Œéœ€ç¡®ä¿ `load_dotenv()` åœ¨åº”ç”¨å…¥å£å°½æ—©è°ƒç”¨ï¼ˆ`app/main.py` å·²è°ƒç”¨ `load_dotenv()`ï¼‰ã€‚
2) åŒåŒºåŸŸæµ‹é€Ÿé€»è¾‘
   - ä»£ç æµç¨‹æ­£ç¡®ï¼šå…ˆ `test_and_update_nodes`ï¼ˆåŸºç¡€ç½‘ç»œæµ‹è¯•å¹¶è®¾ç½® `alive=True`ï¼‰ï¼Œå† `run_advanced_speed_test(self.nodes)` æ·»åŠ  `mainland_*` ä¸ `overseas_*`ã€‚
   - é—®é¢˜æ›´åƒæ˜¯å¤–éƒ¨æ¢æµ‹æœåŠ¡å¯¹å¤šæ•°èŠ‚ç‚¹ `success:false`ï¼Œå› æ­¤åˆ†æ•°ä¸º 0ï¼Œæˆ– `upload_to_supabase` æ²¡æŠŠéé›¶æ•°æ®æˆåŠŸå†™å…¥ Supabaseï¼ˆå½“å‰çœ‹åˆ°çš„äº‹å®æ˜¯ Supabase/å‰ç«¯æ˜¾ç¤ºä»ä¸º 0ï¼‰ã€‚
3) Supabase ä¸Šä¼ é€»è¾‘
   - `upload_to_supabase` ä½¿ç”¨ `supabase.table("nodes").upsert(batch)`ï¼Œè‹¥ Supabase å‡­è¯æˆ–ç½‘ç»œå¼‚å¸¸ä¼šè®°å½•é”™è¯¯å¹¶è¿”å› Falseã€‚
   - éœ€è¦ç¡®è®¤ `.env` ä¸­ `SUPABASE_URL` ä¸ `SUPABASE_KEY` æ˜¯å¦æœ‰æ•ˆï¼Œä»¥åŠä¸Šä¼ æ—¶åç«¯æ—¥å¿—ä¸­æ˜¯å¦è®°å½•äº†ä¸Šä¼ æˆåŠŸã€‚

å…­ã€å¯å¤ç°çš„è¯Šæ–­å‘½ä»¤ï¼ˆé‡å¯åæˆ–å½“å‰ç¯å¢ƒä¸‹å¯ç›´æ¥è¿è¡Œï¼‰
- è§¦å‘æ‰«æï¼ˆæ­£ç¡®è·¯ç”±ï¼‰:
```bash
curl -X POST http://127.0.0.1:8000/nodes/trigger
```
- æŸ¥çœ‹å½“å‰æ‰«æçŠ¶æ€ä¸æ—¥å¿—:
```bash
curl -s http://127.0.0.1:8000/nodes/stats | jq '.'
```
- é€šè¿‡å‰ç«¯ä»£ç†æŸ¥çœ‹èŠ‚ç‚¹æ•°æ®ï¼ˆå‰ 10 æ¡ï¼‰:
```bash
curl -s 'http://127.0.0.1:8080/api/nodes?limit=10' | jq '.'
```
- æ‰‹åŠ¨æµ‹è¯• Aliyun FC / Cloudflare Worker:
```bash
curl -s -X POST 'https://mainland-probe-eyptbwbaco.cn-hangzhou.fcapp.run' \
  -H 'Content-Type: application/json' \
  -d '{"nodes": [{"id":"104.248.161.181:443","host":"104.248.161.181","port":443}]}'

curl -s -X POST 'https://mainland-node-overseas-probe.sdemon9963.workers.dev' \
  -H 'Content-Type: application/json' \
  -d '{"nodes": [{"id":"104.248.161.181:443","host":"104.248.161.181","port":443}]}'
```
- æ£€æŸ¥åç«¯è¿›ç¨‹å¹¶æ€æ­»å¡ä½è¿›ç¨‹ï¼š
```bash
ps aux | grep -E "uvicorn|python|curl" | grep -v grep
kill <PID>
kill -9 <PID>  # å¦‚éœ€è¦
pkill -f uvicorn
```

ä¸ƒã€é‡å¯ VS Code / ä¼šè¯æŒä¹…åŒ–æ³¨æ„äº‹é¡¹ï¼ˆä½ å…³å¿ƒçš„é—®é¢˜ï¼‰
- å¦‚æœä½ é‡å¯ VS Codeï¼š
  - é¡¹ç›®å†…çš„æ–‡ä»¶ï¼ˆå·¥ä½œåŒºç£ç›˜ä¸Šçš„ä»£ç å’Œæˆ‘ç°åœ¨è¦å†™å…¥çš„ `SUMMARY_NODE_TEST.md` æ–‡ä»¶ï¼‰ä¸ä¼šä¸¢å¤±ã€‚é‡å¯åå¯ä»¥ç›´æ¥åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€è¿™äº›æ–‡ä»¶ã€‚
  - å½“å‰ä¸æˆ‘çš„èŠå¤©ä¸Šä¸‹æ–‡ï¼ˆä¼šè¯çŠ¶æ€ï¼‰é€šå¸¸ä¼šä¸¢å¤±ï¼›é‡å¯åæˆ‘ä¸èƒ½ç»§ç»­â€œè®°ä½â€æ­¤å‰å¯¹è¯çš„ä¸´æ—¶å†…å­˜ï¼Œä½†æ‰€æœ‰ä¿å­˜åœ¨ç£ç›˜ä¸Šçš„æ–‡ä»¶å’Œæ—¥å¿—éƒ½è¿˜åœ¨ã€‚
- å»ºè®®åœ¨é‡å¯å‰ï¼š
  1. ä¿å­˜å½“å‰æ–‡ä»¶ï¼ˆæˆ‘å·²æŠŠæ€»ç»“å†™å…¥ `SUMMARY_NODE_TEST.md`ï¼‰ã€‚
  2. å¤åˆ¶ä»»ä½•é‡è¦ç»ˆç«¯è¾“å‡ºæˆ–æ—¥å¿—åˆ°æ–‡ä»¶ï¼ˆæˆ–æŠŠ `nohup.out` / è‡ªå®šä¹‰æ—¥å¿—å­˜å‚¨åˆ°ç£ç›˜ï¼‰ã€‚
  3. è‹¥ä½ æ‰“ç®—é‡å¯æœºå™¨/VS Codeï¼Œè¯·å…ˆé€€å‡ºæˆ–æ€æ‰å¡ä½çš„è¿›ç¨‹ä»¥é¿å…æ®‹ç•™çš„é”æˆ–æŒ‚èµ·çŠ¶æ€ã€‚

å…«ã€ä¸‹ä¸€æ­¥ï¼ˆè¯¦ç»†æ‰§è¡Œè®¡åˆ’ï¼‰
1) ç«‹å³ï¼ˆå¦‚æœä½ è¦æˆ‘ä»£ç†æ“ä½œï¼‰
   - æˆ‘å¯ä»¥è¿œç¨‹åœ¨ workspace å†…åˆ—å‡ºå¹¶ç»ˆæ­¢å¡ä½çš„è¿›ç¨‹ï¼ˆ`uvicorn`/`curl`ï¼‰ï¼Œç„¶åç¡®è®¤ç»ˆç«¯æ¢å¤å“åº”ã€‚  
   - æ‰§è¡Œå®Œåæˆ‘ä¼šå†æ¬¡è§¦å‘ `POST /nodes/trigger` å¹¶ç›‘æ§ `nodes/stats` æ—¥å¿—ç›´åˆ°æµ‹è¯•ç»“æŸæˆ–å‡ºç°é”™è¯¯ã€‚
2) è‹¥ä½ æ‰“ç®—å…ˆé‡å¯ VS Code
   - é‡å¯åæ‰“å¼€æœ¬é¡¹ç›®ï¼Œç¡®è®¤ `SUMMARY_NODE_TEST.md` å­˜åœ¨äº `viper-node-store` ç›®å½•ä¸‹ã€‚
   - ä½¿ç”¨ä¸Šè¿°å‘½ä»¤æ£€æŸ¥å¹¶å¯åŠ¨åç«¯ï¼š
```bash
# åœ¨ backend ç›®å½•
# æ¨èç”¨ conda/venv çš„ Python ç¯å¢ƒ
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
```
   - æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯å¯åŠ¨å‰ç«¯ proxyï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼š
```bash
# åœ¨ viper-node-store é¡¹ç›®ç›®å½•ï¼ˆè‹¥ä½ ç”¨çš„æ˜¯ Python ç®€å•ä»£ç†ï¼‰
python -m http.server 8080
# æˆ–ä½ æœ¬æ¥çš„è¿è¡Œæ–¹å¼
```
   - è§¦å‘æµ‹è¯•å¹¶æŸ¥çœ‹æ—¥å¿—ï¼ˆåŒä¸Šï¼‰ã€‚

ä¹ã€å¦‚æœé‡è¯•åä»ç„¶çœ‹åˆ° `mainland_score=0` / `overseas_score=0` çš„å¯èƒ½åŸå› ä¸æ’æŸ¥æ­¥éª¤
- åŸå›  A: å¤–éƒ¨æµ‹é€ŸæœåŠ¡è¿”å› `success:false`ï¼ˆä¸å¯è¾¾æˆ–è¢«ç›®æ ‡ä¸»æœºæ‹’ç»ï¼‰
  - æ’æŸ¥ï¼šåœ¨ä¸åŒç½‘ç»œï¼ˆä¾‹å¦‚åœ¨èƒ½è®¿é—®ç›®æ ‡èŠ‚ç‚¹çš„æœºæˆ¿æˆ–äº‘å‡½æ•°æ‰€åœ¨åŒºåŸŸï¼‰è¿è¡Œæµ‹è¯•ï¼›æˆ–æŠŠå•ä¸ªå·²çŸ¥å¯è¿é€šèŠ‚ç‚¹æµ‹è¯•ç»™å¤–éƒ¨æœåŠ¡ç¡®è®¤ã€‚
- åŸå›  B: åç«¯æ²¡æœ‰æŠŠéé›¶ç»“æœå†™å…¥ Supabaseï¼ˆæƒé™/å‡­è¯é—®é¢˜ï¼‰
  - æ’æŸ¥ï¼šåœ¨åç«¯æ—¥å¿—ä¸­æŸ¥æ‰¾ `Supabase ä¸Šä¼ å®Œæˆ` æˆ– `Supabase ä¸Šä¼ å¤±è´¥` çš„æ—¥å¿—è¡Œï¼›ç¡®è®¤ `.env` ä¸­ `SUPABASE_URL` ä¸ `SUPABASE_KEY` æ˜¯å¦æœ‰æ•ˆã€‚
- åŸå›  C: ç¯å¢ƒå˜é‡åŠ è½½æ—¶åºé—®é¢˜ï¼ˆæ¨¡å—å¯¼å…¥æ—©äº `load_dotenv()`ï¼‰
  - æ’æŸ¥ï¼šç¡®è®¤ `app/main.py` åœ¨æœ€å¼€å§‹å°±è°ƒç”¨ `load_dotenv()`ï¼Œæˆ–è€…æŠŠ `ADVANCED_TEST_ENABLED` çš„è¯»å–æ”¹ä¸ºåœ¨è¿è¡Œæ—¶è¯»å– `os.getenv()` è€Œéæ¨¡å—å¯¼å…¥æ—¶å›ºå®šå€¼ã€‚

åã€æˆ‘å·²å†™å…¥çš„æ–‡ä»¶
- `viper-node-store/SUMMARY_NODE_TEST.md`ï¼ˆå®Œæ•´æ€»ç»“ï¼Œå·²ä¿å­˜åˆ°å·¥ä½œåŒºï¼‰
  - è·¯å¾„: `/Users/ikun/study/Learning/viper-node-store/SUMMARY_NODE_TEST.md`

åä¸€ã€å·²æ‰§è¡Œçš„ä¿®å¤æ­¥éª¤ï¼ˆ2025-12-31 02:30-02:35ï¼‰
ç”¨æˆ·é€‰æ‹©é€‰é¡¹ 1ï¼šåº”ç”¨æ¨èä¿®å¤ + æ€æ‰å¡ä½è¿›ç¨‹ + é‡å¯åç«¯ã€‚

1) **ä¿®å¤ç¯å¢ƒå˜é‡åŠ è½½æ—¶åºé—®é¢˜**
   - ä¿®æ”¹æ–‡ä»¶ï¼š`app/modules/node_hunter/advanced_speed_test.py`
   - é—®é¢˜æ ¹æºï¼š`ADVANCED_TEST_ENABLED = os.getenv(...)` åœ¨æ¨¡å—å¯¼å…¥æ—¶å›ºå®šè¯»å–ï¼ˆæ¨¡å—å¯¼å…¥æ—©äº `load_dotenv()`ï¼‰ã€‚
   - è§£å†³æ–¹æ¡ˆï¼š
     - æ·»åŠ è¿è¡Œæ—¶è¯»å–å‡½æ•°ï¼š`is_advanced_test_enabled()`, `get_aliyun_url()`, `get_cloudflare_url()`
     - åœ¨ `test_nodes_via_aliyun()`, `test_nodes_via_cloudflare()`, `run_advanced_speed_test()` ä¸­ç”¨å‡½æ•°è°ƒç”¨æ›¿ä»£æ¨¡å—çº§å˜é‡ã€‚
   - ç»“æœï¼šç¯å¢ƒå˜é‡ç°åœ¨åœ¨è¿è¡Œæ—¶ï¼ˆé«˜çº§æµ‹é€Ÿæ‰§è¡Œæ—¶ï¼‰åŠ¨æ€è¯»å–ï¼Œ`.env` ä¸­çš„é…ç½®ç”Ÿæ•ˆã€‚

2) **é‡å¯åç«¯è¿›ç¨‹**
   - åœæ­¢äº†å…ˆå‰çš„ uvicorn è¿›ç¨‹ï¼ˆæ— å“åº”çŠ¶æ€ï¼‰ã€‚
   - åœ¨åå°å¯åŠ¨æ–°çš„åç«¯ï¼š`nohup uvicorn app.main:app --reload --host 127.0.0.1 --port 8000 > /tmp/backend.log 2>&1 &`

3) **éªŒè¯ä¿®å¤æ•ˆæœ**
   - è§¦å‘ `POST /nodes/trigger` æ‰«æã€‚
   - æŸ¥çœ‹æ—¥å¿—ä¸­çš„é«˜çº§æµ‹é€Ÿå¼€å…³çŠ¶æ€ï¼šâœ… æ—¥å¿—æ˜¾ç¤º `ğŸ”§ é«˜çº§æµ‹é€Ÿå¼€å…³: True (ADVANCED_TEST_ENABLED=true)`
   - è¿™è¯æ˜ **ç¯å¢ƒå˜é‡ç°åœ¨è¢«æ­£ç¡®è¯»å–** å¹¶ä¸”é«˜çº§æµ‹é€Ÿæ¨¡å—å·²æ¿€æ´»ã€‚

åäºŒã€ç›®å‰çŠ¶æ€ï¼ˆå¾…ç›‘æµ‹ï¼‰
- åç«¯æ­£åœ¨è¿è¡Œæ‰«æå‘¨æœŸï¼ˆ259/407 æœ‰æ•ˆèŠ‚ç‚¹å·²æµ‹è¯•ï¼‰ã€‚
- é«˜çº§æµ‹é€Ÿå¼€å…³å·²ç¡®è®¤å¯ç”¨ã€‚
- ä»éœ€éªŒè¯ï¼š
  1. Aliyun FC å’Œ Cloudflare Worker æ˜¯å¦æˆåŠŸè·å¾—æµ‹é€Ÿç»“æœï¼ˆæŸ¥çœ‹ç›¸å…³æ—¥å¿—ï¼‰ã€‚
  2. åç«¯æ˜¯å¦æˆåŠŸå°† `mainland_score/latency` å’Œ `overseas_score/latency` å†™å…¥ Supabaseã€‚
  3. å‰ç«¯æ˜¯å¦èƒ½é€šè¿‡ API æŸ¥è¯¢åˆ°æ›´æ–°åçš„èŠ‚ç‚¹æ•°æ®ï¼ˆå¯ä»¥é€šè¿‡ `/api/nodes` æˆ–å…¶ä»–æš´éœ²çš„ç«¯ç‚¹ï¼‰ã€‚

åä¸‰ã€å®æ—¶æ‰§è¡ŒéªŒè¯ï¼ˆåç«¯æ—¥å¿—ç¡®è®¤ï¼‰
ç»æ£€æŸ¥ `/tmp/backend.log`ï¼Œè¯å®é«˜çº§æµ‹é€Ÿæ­£åœ¨å®æ—¶æ‰§è¡Œï¼š
1) **Aliyun FC å¤§é™†æµ‹é€Ÿ** âœ… **æ­£åœ¨æ‰§è¡Œ**
   - æ—¥å¿—æ ·æœ¬ï¼š
     ```
     INFO:app.modules.node_hunter.advanced_speed_test:âœ… yd2.ainivp.com | mainland å»¶è¿Ÿ: 47ms (åˆ†æ•°: 100)
     INFO:app.modules.node_hunter.advanced_speed_test:âœ… zz6.91js.pw | mainland å»¶è¿Ÿ: 180ms (åˆ†æ•°: 60)
     INFO:app.modules.node_hunter.advanced_speed_test:âœ… 172.67.187.114 | mainland å»¶è¿Ÿ: 160ms (åˆ†æ•°: 60)
     ...ï¼ˆæ‰¹æ¬¡ 1-11 æ­£åœ¨è¿›è¡Œï¼Œå¤šä¸ªèŠ‚ç‚¹å·²è·å¾—åˆ†æ•°ï¼‰
     ```
   - è§‚å¯Ÿï¼šéƒ¨åˆ†èŠ‚ç‚¹å·²æˆåŠŸè·å¾— `mainland å»¶è¿Ÿ` å’Œ `mainland åˆ†æ•°`ã€‚
   - æ³¨æ„ï¼šéƒ¨åˆ†æ‰¹æ¬¡å‡ºç° `TimeoutError`ï¼ˆå¯èƒ½æ˜¯ç½‘ç»œå»¶è¿Ÿæˆ–å¤–éƒ¨æœåŠ¡å‹åŠ›ï¼‰ï¼Œä½†ä¸å½±å“å·²æˆåŠŸçš„èŠ‚ç‚¹ã€‚

2) **Cloudflare Worker æµ·å¤–æµ‹é€Ÿ** â³ **å¾…å¯åŠ¨**ï¼ˆAliyun å®Œæˆåå¼€å§‹ï¼‰
   - é¢„æœŸï¼šåœ¨ Aliyun æ‰€æœ‰æ‰¹æ¬¡å®Œæˆåï¼Œå¼€å§‹ Cloudflare æµ‹é€Ÿã€‚

3) **Supabase ä¸Šä¼ ** â³ **å¾…éªŒè¯**ï¼ˆæµ‹é€Ÿå®Œå…¨å®Œæˆåï¼‰
   - é¢„æœŸï¼šåœ¨åŒåŒºåŸŸæµ‹é€Ÿå®Œæˆåï¼Œåç«¯å°†è°ƒç”¨ `upload_to_supabase()` æŠŠèŠ‚ç‚¹æ•°æ®å†™å…¥æ•°æ®åº“ã€‚

4) **å‰ç«¯ API æ•°æ®æ›´æ–°** â³ **å¾…éªŒè¯**
   - é¢„æœŸï¼šSupabase æ›´æ–°åï¼Œé€šè¿‡ `/api/nodes` æˆ–å…¶ä»–ç«¯ç‚¹å¯æŸ¥åˆ° `mainland_score` å’Œ `overseas_score`ã€‚

åå››ã€ä¸‹ä¸€æ­¥ç›‘æµ‹æ­¥éª¤ï¼ˆç”¨æˆ·æŒ‡å¼•ï¼‰

---

åå››ã€ä¸‹ä¸€æ­¥ç›‘æµ‹æ­¥éª¤ï¼ˆç”¨æˆ·æŒ‡å¼•ï¼‰
1) **ç»§ç»­ç›‘æµ‹åç«¯æ—¥å¿—ï¼ŒæŸ¥çœ‹ Cloudflare å’Œ Supabase ä¸Šä¼ **
   ```bash
   tail -f /tmp/backend.log | grep -E "Cloudflare|Supabase|å®Œæˆ|ä¸Šä¼ "
   ```

2) **ä½¿ç”¨å‘½ä»¤æŸ¥è¯¢æ€»ä½“æµ‹é€Ÿè¿›åº¦**
   ```bash
   curl -s http://127.0.0.1:8000/nodes/stats | jq '.logs | map(select(. | contains("Aliyun") or contains("å®Œæˆ"))) | .[-5:]'
   ```

3) **é¢„æœŸæ—¶é—´è¡¨**
   - Aliyun å¤§é™†æµ‹é€Ÿï¼š~15-30 åˆ†é’Ÿ
   - Cloudflare æµ·å¤–æµ‹é€Ÿï¼š~15-30 åˆ†é’Ÿ
   - Supabase ä¸Šä¼ ï¼š~5-10 åˆ†é’Ÿ
   - **æ€»è®¡ï¼šçº¦ 1 å°æ—¶**

4) **æµ‹é€Ÿå®Œå…¨å®Œæˆåçš„éªŒè¯**
   ```bash
   curl -s 'http://127.0.0.1:8000/nodes' | jq '.[] | select(.mainland_score > 0)' | head -5
   ```

---
**ä¿®å¤çŠ¶æ€æ€»ç»“**ï¼šâœ… ç¯å¢ƒå˜é‡åŠ è½½æ—¶åºé—®é¢˜å·²ä¿®å¤ï¼Œé«˜çº§åŒåŒºåŸŸæµ‹é€Ÿæ­£åœ¨å®æ—¶æ‰§è¡Œä¸­ã€‚
