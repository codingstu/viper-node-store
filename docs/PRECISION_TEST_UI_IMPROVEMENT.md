# 精确测速 UI 改进 - 添加确认对话框

## 问题

用户点击文件大小按钮后，进入了一个对话框但没有看到确认按钮，无法继续操作。

## 解决方案

添加了一个**两步确认流程**：

### 新的工作流程

**第一步：文件大小选择**
```
精确测速
├─ 10 MB  按钮
├─ 25 MB  按钮
├─ 50 MB  按钮
└─ 100 MB 按钮
```

**第二步：确认对话框** (点击任一文件大小后)
```
确认测速参数：
├─ 文件大小: 50 MB
├─ 预计流量消耗: 50 MB
├─ 预计耗时: 1-30 秒
│
⚠️ 精确测速会消耗对应流量，请确认后再开始
│
└─ [取消] [确认开始] 按钮
```

**第三步：测速进行中**
```
测试进行中，请稍候...
[========== 进度条 ==========] 50%
```

**第四步：显示结果**
```
✅ 精确测速完成: 45.67 MB/s

下载速度: 45.67 MB/s
用时: 1.23s
流量消耗: 50.0MB

[关闭]
```

## 修改内容

### HTML 变更
- 添加了 `precision-test-confirm` 区域（确认对话框）
- 添加了"预计流量消耗"和"预计耗时"信息显示
- 添加了"取消"和"确认开始"两个按钮

### JavaScript 变更
添加了 4 个新函数：

1. **selectPrecisionTestSize(sizeInMb)**
   - 用户选择文件大小时调用
   - 显示确认对话框
   - 更新确认信息

2. **cancelPrecisionTest()**
   - 用户点"取消"时调用
   - 返回到文件大小选择
   - 重置选择状态

3. **confirmPrecisionTest()**
   - 用户点"确认开始"时调用
   - 启动真实测速

4. **startPrecisionTest(fileSizeMs)** (修改)
   - 现在由 confirmPrecisionTest() 调用
   - 执行异步下载测速

## 文件变更

| 文件 | 行数 | 改动 |
|------|------|------|
| index.html | 413-480 | 修改模态框 HTML，添加确认对话框 |
| index.html | 1245-1270 | 添加新的 JavaScript 函数 |

## 使用流程

1. 点击节点上的 ⚡ 按钮 → 打开精确测速模态框
2. 点击文件大小（10/25/50/100 MB）→ 显示确认对话框
3. 查看预计流量和耗时 → 点击"确认开始"
4. 等待进度条完成 → 查看测速结果

## 测试建议

1. **打开后端**:
   ```bash
   cd /Users/ikun/study/Learning/viper-node-store
   python app_fastapi.py
   ```

2. **刷新前端**:
   ```
   http://localhost:8002
   ```

3. **测试流程**:
   - 找到任意节点
   - 点击 ⚡ 按钮
   - 选择文件大小（例如 10 MB 快速测试）
   - **现在应该看到确认对话框**
   - 点击"确认开始"
   - 观察进度条和最终结果

## 技术细节

### UI 状态管理

四个可见/隐藏的区域：
- `precision-test-content`: 文件大小选择
- `precision-test-confirm`: 确认对话框
- `precision-test-running`: 测速进行中
- `precision-test-result`: 显示结果

### 用户选择保存

通过全局变量 `selectedTestSize` 保存用户选择，确保：
- 用户可以取消返回修改选择
- 最终确认时能正确传递所选大小

---

**修改日期**: 2024-01-15  
**改进内容**: 添加确认对话框，改善用户体验  
**状态**: ✅ 完成
